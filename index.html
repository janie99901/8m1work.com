<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tele Mini App Ki·∫øm Ti·ªÅn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #4F8A8B;
            --secondary: #F6C90E;
            --bg: #F7F7F7;
            --text: #222831;
            --success: #43C59E;
            --danger: #FF4C29;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background: var(--primary);
            color: #fff;
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            letter-spacing: 1px;
            position: relative;
        }
        .balance-show {
            position: absolute;
            right: 20px;
            top: 15px;
            font-weight: bold;
            color: var(--secondary);
            background: #fff8;
            padding: 7px 14px;
            border-radius: 20px;
            font-size: 1em;
        }
        .container {
            max-width: 500px;
            margin: 30px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px #0001;
            padding: 24px;
            min-height: 500px;
        }
        .tab-btns {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .tab-btn {
            flex: 1;
            padding: 10px 0;
            background: #eee;
            border: none;
            border-radius: 5px 5px 0 0;
            margin: 0 2px;
            font-weight: bold;
            color: var(--primary);
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            background: var(--primary);
            color: #fff;
            border-bottom: 2px solid var(--secondary);
        }
        .hidden { display: none; }
        .task-card {
            background: #f9f9f9;
            border-left: 6px solid var(--secondary);
            margin-bottom: 16px;
            border-radius: 8px;
            padding: 15px;
        }
        .task-actions button,
        .form-group input,
        .form-group select {
            padding: 8px;
            margin-top: 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%;
            box-sizing: border-box;
        }
        .task-actions button {
            width: auto;
            background: var(--primary);
            color: #fff;
            border: none;
            font-weight: 500;
            margin-right: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .task-actions button.done {
            background: var(--success);
        }
        .task-actions button.x {
            background: var(--danger);
        }
        .task-actions button.del {
            background: var(--danger);
        }
        .form-group {
            margin-bottom: 12px;
        }
        .form-group label {
            font-weight: 500;
        }
        .withdraw-form button {
            background: var(--secondary);
            color: var(--text);
            border: none;
            width: 100%;
            padding: 10px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
        }
        .admin-form button {
            background: var(--primary);
            color: #fff;
            border: none;
            width: 100%;
            padding: 10px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
        }
        .alert {
            padding: 10px;
            background: var(--success);
            color: #fff;
            border-radius: 6px;
            margin-bottom: 12px;
            text-align: center;
        }
        .banner-ad {
            margin: 8px 0 18px 0;
            box-shadow: 0 2px 8px #0001;
            border-radius: 8px;
            overflow: hidden;
            background: #fffbe8;
            padding: 10px;
            text-align: center;
        }
        .banner-ad h3 {
            color: var(--danger);
            margin: 0 0 5px 0;
        }
        .banner-ad img {
            max-width: 100%;
            border-radius: 7px;
            margin-bottom: 6px;
        }
        progress {
            width: 100%;
            height: 18px;
            margin-top: 8px;
        }
        .admin-only { display: none; }
    </style>
</head>
<body>
    <header class="header">
    <span class="logo">8M1WORK Ki·∫øm Ti·ªÅn</span>
    <span class="balance-show">S·ªë d∆∞: <span id="balanceHeader">0</span> ƒë</span>
</header>

<style>
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: #4d908e;
        color: white;
        font-weight: bold;
        font-size: 16px;
    }

    .balance-show {
        font-size: 14px;
        color: #ffeb3b;
    }

    .logo {
        font-size: 18px;
    }
</style>
    <div class="container">

        <div class="tab-btns">
            <button class="tab-btn active" id="tab-btn-link" onclick="showTab('link')">V∆∞·ª£t link</button>
            <button class="tab-btn" id="tab-btn-ad" onclick="showTab('ad')">Qu·∫£ng c√°o</button>
            <button class="tab-btn" id="tab-btn-app" onclick="showTab('app')">T·∫£i app</button>
            <button class="tab-btn" id="tab-btn-withdraw" onclick="showTab('withdraw')">R√∫t ti·ªÅn</button>
            <button class="tab-btn admin-only" id="tab-btn-admin" onclick="showTab('admin')">Admin</button>
        </div>

        <!-- Nhi·ªám v·ª• V∆∞·ª£t link -->
        <div id="tab-link">
            <h2>Nhi·ªám v·ª• v∆∞·ª£t link</h2>
            <div id="task-list-link"></div>
        </div>

        <!-- Nhi·ªám v·ª• Qu·∫£ng c√°o -->
        <div id="tab-ad" class="hidden">
            <h2>Nhi·ªám v·ª• xem qu·∫£ng c√°o</h2>
            <!-- Banner qu·∫£ng c√°o ƒëa d·∫°ng HTML -->
            <div class="banner-ad" id="banner-ad">
                <h3>üî• ∆Øu ƒë√£i ƒë·∫∑c bi·ªát!</h3>
                <img src="https://cdn.pixabay.com/photo/2017/01/06/19/15/banner-1954294_640.jpg" alt="Banner Qu·∫£ng C√°o">
                <div>
                    <span style="font-size:1.1em;color:var(--primary);">Nh·∫•n v√†o qu·∫£ng c√°o n√†y ƒë·ªÉ nh·∫≠n th∆∞·ªüng!</span>
                    <br>
                    <a href="https://your-ad-link.com" target="_blank" style="background:var(--secondary);color:var(--text);padding:7px 12px;text-decoration:none;border-radius:4px;margin-top:6px;display:inline-block">Xem ngay</a>
                </div>
            </div>
            <div id="task-list-ad"></div>
        </div>

        <!-- Nhi·ªám v·ª• T·∫£i app -->
        <div id="tab-app" class="hidden">
            <h2>Nhi·ªám v·ª• t·∫£i app</h2>
            <div id="task-list-app"></div>
        </div>

        <!-- R√∫t ti·ªÅn -->
        <div id="tab-withdraw" class="hidden">
            <h2>R√∫t ti·ªÅn</h2>
            <form class="withdraw-form" onsubmit="withdraw(event)">
                <div class="form-group">
                    <label>S·ªë d∆∞ hi·ªán t·∫°i: <span id="balance">0</span> ƒë</label>
                </div>
                <div class="form-group">
                    <label>H·ªç t√™n ch·ªß t√†i kho·∫£n</label>
                    <input type="text" id="owner" required>
                </div>
                <div class="form-group">
                    <label>T√™n ng√¢n h√†ng</label>
                    <input type="text" id="bank" required>
                </div>
                <div class="form-group">
                    <label>S·ªë t√†i kho·∫£n</label>
                    <input type="text" id="account" required>
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn mu·ªën r√∫t (>= 20.000ƒë)</label>
                    <input type="number" id="money" min="20000" required>
                </div>
                <button type="submit">R√∫t ti·ªÅn</button>
            </form>
            <div id="withdraw-alert" class="alert hidden"></div>
        </div>

        <!-- Admin -->
        <div id="tab-admin" class="hidden">
            <h2>Th√™m nhi·ªám v·ª•</h2>
            <form class="admin-form" onsubmit="addTask(event)">
                <div class="form-group">
                    <label>T√™n nhi·ªám v·ª•</label>
                    <input type="text" id="taskName" required>
                </div>
                <div class="form-group">
                    <label>Lo·∫°i nhi·ªám v·ª•</label>
                    <select id="taskType" required onchange="toggleIdPhoneReq()">
                        <option value="v∆∞·ª£t_link">V∆∞·ª£t link</option>
                        <option value="qu·∫£ng_c√°o">Qu·∫£ng c√°o</option>
                        <option value="t·∫£i_app">T·∫£i app</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn th∆∞·ªüng</label>
                    <input type="number" id="taskReward" min="100" required>
                </div>
                <div class="form-group">
                    <label>S·ªë l∆∞·ª£t</label>
                    <input type="number" id="taskMaxUsers" min="1" required>
                </div>
                <div class="form-group">
                    <label>Link nhi·ªám v·ª•</label>
                    <input type="text" id="taskUrl" required>
                </div>
                <div class="form-group" id="idPhoneReqGroup" style="display:none">
                    <label>Y√™u c·∫ßu ID/SƒêT khi ho√†n th√†nh?</label>
                    <select id="taskIdPhoneReq">
                        <option value="false">Kh√¥ng</option>
                        <option value="true">C√≥</option>
                    </select>
                </div>
                <button type="submit">Th√™m nhi·ªám v·ª•</button>
            </form>

            <h2>Danh s√°ch nhi·ªám v·ª•</h2>
            <div id="admin-task-list"></div>
        </div>

    </div>
    <script>
        // ƒê·∫∑t quy·ªÅn admin ·ªü ƒë√¢y
        let isAdmin = false; // ƒê·ªïi th√†nh true n·∫øu l√† admin

        let balance = 0;
        let tasks = [
            {
                name: "V∆∞·ª£t link ki·∫øm ti·ªÅn",
                type: "v∆∞·ª£t_link",
                reward: 500,
                max_users: 100,
                url: "https://shortlink.com/abc",
                require_id: false,
                done: 0,
                id: 1
            },
            {
                name: "Xem qu·∫£ng c√°o 15s",
                type: "qu·∫£ng_c√°o",
                reward: 300,
                max_users: 200,
                url: "https://ads.com/xyz",
                require_id: false,
                done: 0,
                id: 2
            },
            {
                name: "T·∫£i app ABC",
                type: "t·∫£i_app",
                reward: 1000,
                max_users: 50,
                url: "https://play.google.com/store/apps/abc",
                require_id: true,
                done: 0,
                id: 3,
                pending: []
            }
        ];
        let nextTaskId = 4;

        // Tab switching
        function showTab(tab) {
            let tabs = ['link', 'ad', 'app', 'withdraw', 'admin'];
            tabs.forEach(t => document.getElementById('tab-' + t).classList.add('hidden'));
            tabs.forEach(t => document.getElementById('tab-btn-' + t).classList.remove('active'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.getElementById('tab-btn-' + tab).classList.add('active');
            if(tab === 'link') renderTasks('v∆∞·ª£t_link');
            if(tab === 'ad') renderTasks('qu·∫£ng_c√°o');
            if(tab === 'app') renderTasks('t·∫£i_app');
            if(tab === 'admin') renderAdminTasks();
            if(tab === 'withdraw') renderBalance();
            updateBalanceHeader();
        }

        // Render nhi·ªám v·ª• theo lo·∫°i cho user
        function renderTasks(type) {
            let html = "";
            tasks.forEach((task, idx) => {
                if (task.type !== type || task.done >= task.max_users) return;
                html += `<div class="task-card">
                    <b>${task.name}</b> <span style="color:var(--secondary);float:right">${task.reward}ƒë</span><br>
                    <i>Lo·∫°i: ${task.type.replace('_',' ')}</i> | S·ªë l∆∞·ª£t c√≤n: ${task.max_users - task.done}
                    <div class="task-actions" id="actions-${type}-${task.id}">
                        ${task.type === 'v∆∞·ª£t_link' ? `
                            <button onclick="startLinkTask(${task.id})" id="btn-start-link-${task.id}">B·∫Øt ƒë·∫ßu</button>
                            <button onclick="completeLinkTask(${task.id})" id="btn-done-link-${task.id}" disabled>Ho√†n th√†nh</button>
                            <progress id="progress-link-${task.id}" value="0" max="45" class="hidden"></progress>
                        ` : ''}
                        ${task.type === 'qu·∫£ng_c√°o' ? `
                            <button onclick="startAdTask(${task.id})" id="btn-ad-${task.id}">Th·ª±c hi·ªán</button>
                            <progress id="progress-ad-${task.id}" value="0" max="15" class="hidden"></progress>
                            <button onclick="completeAdTask(${task.id})" id="btn-x-${task.id}" class="x hidden">X</button>
                        ` : ''}
                        ${task.type === 't·∫£i_app' ? `
                            <button onclick="startAppTask(${task.id})" id="btn-app-${task.id}">Th·ª±c hi·ªán</button>
                        ` : ''}
                    </div>
                </div>`;
            });
            if(type === 'v∆∞·ª£t_link')
                document.getElementById('task-list-link').innerHTML = html;
            if(type === 'qu·∫£ng_c√°o')
                document.getElementById('task-list-ad').innerHTML = html;
            if(type === 't·∫£i_app')
                document.getElementById('task-list-app').innerHTML = html;
        }

        // Link Task Logic
        let linkTimers = {};
        let activeLinkTask = {};
        function startLinkTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            if (!activeLinkTask[taskId]) {
                window.open(task.url, '_blank');
                document.getElementById(`btn-start-link-${taskId}`).disabled = true;
                document.getElementById(`progress-link-${taskId}`).classList.remove('hidden');
                let time = 0;
                activeLinkTask[taskId] = { time: 0, timer: null, started: true };
                linkTimers[taskId] = setInterval(() => {
                    time++;
                    activeLinkTask[taskId].time = time;
                    document.getElementById(`progress-link-${taskId}`).value = time;
                    if (time >= 45) {
                        clearInterval(linkTimers[taskId]);
                        document.getElementById(`btn-done-link-${taskId}`).disabled = false;
                        activeLinkTask[taskId].canComplete = true;
                    }
                }, 1000);
            }
        }
        function completeLinkTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            let active = activeLinkTask[taskId];
            if (active && active.time >= 45 && active.canComplete) {
                balance += task.reward;
                task.done++;
                delete activeLinkTask[taskId];
                renderTasks('v∆∞·ª£t_link');
                renderBalance();
                updateBalanceHeader();
                showAlert('ƒê√£ c·ªông ti·ªÅn!', 'link');
            } else if (active && active.started) {
                showAlert('Ch∆∞a ƒë·ªß th·ªùi gian! H√£y ƒë·ª£i ƒë·ªß 45 gi√¢y.', 'link');
            } else {
                showAlert('B·∫°n ch∆∞a b·∫Øt ƒë·∫ßu nhi·ªám v·ª• n√†y ho·∫∑c ƒë√£ tho√°t ra. Vui l√≤ng nh·∫•n "B·∫Øt ƒë·∫ßu" l·∫°i.', 'link');
            }
        }

        // Khi ng∆∞·ªùi d√πng v√¥ t√¨nh reload/tho√°t, kh√¥ng m·∫•t nhi·ªám v·ª•
        // N·∫øu ch∆∞a ho√†n th√†nh th√¨ cho b·∫Øt ƒë·∫ßu l·∫°i, kh√¥ng c·ªông ti·ªÅn
        window.onbeforeunload = function() {
            Object.keys(linkTimers).forEach(id=>clearInterval(linkTimers[id]));
            activeLinkTask = {};
        }

        // Ad Task Logic
        let adTimers = {};
        function startAdTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            window.open(task.url, '_blank');
            document.getElementById(`btn-ad-${taskId}`).disabled = true;
            document.getElementById(`progress-ad-${taskId}`).classList.remove('hidden');
            let time = 0;
            adTimers[taskId] = setInterval(() => {
                time++;
                document.getElementById(`progress-ad-${taskId}`).value = time;
                if (time >= 15) {
                    clearInterval(adTimers[taskId]);
                    document.getElementById(`btn-x-${taskId}`).classList.remove('hidden');
                }
            }, 1000);
        }
        function completeAdTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            balance += task.reward;
            task.done++;
            renderTasks('qu·∫£ng_c√°o');
            renderBalance();
            updateBalanceHeader();
            showAlert('ƒê√£ c·ªông ti·ªÅn!', 'ad');
        }

        // App Task Logic
        function startAppTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            window.open(task.url, '_blank');
            let formHtml = `<div class="alert">
                <b>Nh·∫≠p ${task.require_id ? 'ID ho·∫∑c SƒêT' : ''} ƒë·ªÉ x√°c nh·∫≠n t·∫£i app</b>
                <input type="text" id="app-check-${taskId}" placeholder="Nh·∫≠p ${task.require_id ? 'ID ho·∫∑c SƒêT' : ''}" style="margin-top:8px;">
                <button onclick="submitAppTask(${taskId})" class="done" style="margin-top:6px;">G·ª≠i x√°c nh·∫≠n</button>
            </div>`;
            document.getElementById(`actions-t·∫£i_app-${taskId}`).innerHTML += formHtml;
        }
        function submitAppTask(taskId) {
            let task = tasks.find(t=>t.id === taskId);
            let val = document.getElementById(`app-check-${taskId}`).value;
            if (task.require_id && !val) {
                showAlert('B·∫°n c·∫ßn nh·∫≠p ID/SƒêT!', 'app');
                return;
            }
            task.pending = task.pending || [];
            task.pending.push(val);
            showAlert('Ch·ªù admin duy·ªát!', 'app');
            renderTasks('t·∫£i_app');
        }

        // R√∫t ti·ªÅn
        function renderBalance() {
            document.getElementById('balance').innerText = balance;
        }
        function updateBalanceHeader() {
            document.getElementById('balanceHeader').innerText = balance;
        }
        function withdraw(e) {
            e.preventDefault();
            let owner = document.getElementById('owner').value.trim();
            let bank = document.getElementById('bank').value.trim();
            let account = document.getElementById('account').value.trim();
            let money = Number(document.getElementById('money').value);
            if (money > balance) {
                showAlert('Kh√¥ng ƒë·ªß s·ªë d∆∞!', 'withdraw');
                return;
            }
            if (money < 20000) {
                showAlert('S·ªë ti·ªÅn r√∫t ph·∫£i >= 20.000ƒë!', 'withdraw');
                return;
            }
            balance -= money;
            showAlert('Y√™u c·∫ßu r√∫t ti·ªÅn ƒë√£ g·ª≠i!', 'withdraw');
            renderBalance();
            updateBalanceHeader();
            e.target.reset();
        }

        // Alert helper
        function showAlert(msg, tab) {
            let alertDiv;
            if(tab === 'link') alertDiv = getAlertBox('task-list-link');
            else if(tab === 'ad') alertDiv = getAlertBox('task-list-ad');
            else if(tab === 'app') alertDiv = getAlertBox('task-list-app');
            else alertDiv = document.getElementById('withdraw-alert');
            alertDiv.innerHTML = msg;
            alertDiv.classList.remove('hidden');
            setTimeout(()=>alertDiv.classList.add('hidden'), 2500);
        }
        function getAlertBox(parentId) {
            let parent = document.getElementById(parentId);
            let alert = parent.querySelector('.alert');
            if(!alert) {
                alert = document.createElement('div');
                alert.className = 'alert hidden';
                parent.prepend(alert);
            }
            return alert;
        }

        // Admin Task Render
        function renderAdminTasks() {
            let html = "";
            tasks.forEach((task, idx) => {
                html += `<div class="task-card">
                    <b>${task.name}</b> <span style="color:var(--secondary);float:right">${task.reward}ƒë</span><br>
                    <i>Lo·∫°i: ${task.type.replace('_',' ')}</i> | S·ªë l∆∞·ª£t ƒë√£ l√†m: ${task.done}/${task.max_users}
                    <br>Link: <a href="${task.url}" target="_blank">${task.url}</a>
                    <button class="del" onclick="deleteTask(${task.id})">X√≥a</button>
                    ${task.type === 't·∫£i_app' && task.pending && task.pending.length ? `
                        <div style="margin-top:6px;">
                            <b>Y√™u c·∫ßu duy·ªát t·∫£i app:</b>
                            <ul>${task.pending.map((p,i)=>`
                                <li>${p} <button onclick="approveApp(${task.id},${i})" style="background:var(--success);color:#fff;border:none;padding:2px 6px;border-radius:4px;">Duy·ªát</button></li>
                            `).join('')}</ul>
                        </div>
                    ` : ''}
                </div>`;
            });
            document.getElementById('admin-task-list').innerHTML = html;
        }
        function deleteTask(taskId) {
            tasks = tasks.filter(t=>t.id!==taskId);
            renderAdminTasks();
            renderTasks('v∆∞·ª£t_link');
            renderTasks('qu·∫£ng_c√°o');
            renderTasks('t·∫£i_app');
        }
        // Admin approve t·∫£i app
        function approveApp(taskId, pIdx) {
            let task = tasks.find(t=>t.id === taskId);
            balance += task.reward;
            task.done++;
            task.pending.splice(pIdx, 1);
            renderAdminTasks();
            renderTasks('t·∫£i_app');
            renderBalance();
            updateBalanceHeader();
        }

        // Admin add task
        function addTask(e) {
            e.preventDefault();
            let name = document.getElementById('taskName').value;
            let type = document.getElementById('taskType').value;
            let reward = Number(document.getElementById('taskReward').value);
            let maxUsers = Number(document.getElementById('taskMaxUsers').value);
            let url = document.getElementById('taskUrl').value;
            let require_id = type === 't·∫£i_app' ? document.getElementById('taskIdPhoneReq').value === 'true' : false;
            tasks.push({
                name, type, reward, max_users: maxUsers, url, require_id, done: 0, id: nextTaskId++, pending: []
            });
            showAlert('Th√™m nhi·ªám v·ª• th√†nh c√¥ng!', 'admin');
            e.target.reset();
            renderAdminTasks();
            renderTasks('v∆∞·ª£t_link');
            renderTasks('qu·∫£ng_c√°o');
            renderTasks('t·∫£i_app');
        }

        function toggleIdPhoneReq() {
            const type = document.getElementById('taskType').value;
            document.getElementById('idPhoneReqGroup').style.display = type === 't·∫£i_app' ? '' : 'none';
        }

        // Kh·ªüi t·∫°o tab
        function setupTabs() {
            if(isAdmin) {
                document.getElementById('tab-btn-admin').classList.remove('admin-only');
            } else {
                document.getElementById('tab-btn-admin').classList.add('admin-only');
                document.getElementById('tab-admin').classList.add('hidden');
            }
        }

        setupTabs();
        showTab('link');
    </script>
</body>
</html>